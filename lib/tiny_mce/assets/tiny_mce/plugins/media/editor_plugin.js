var mediaTitle=t("application.inlineEditor.media.title");var mediaEdit=t("application.inlineEditor.media.edit");(function(){var d=tinymce.explode("id,name,width,height,style,align,class,hspace,vspace,bgcolor,type"),g=tinymce.makeMap(d.join(",")),b=tinymce.html.Node,e,a,f=tinymce.util.JSON;e=[["Flash","d27cdb6e-ae6d-11cf-96b8-444553540000","application/x-shockwave-flash","http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0"],["ShockWave","166b1bca-3f9c-11cf-8075-444553540000","application/x-director","http://download.macromedia.com/pub/shockwave/cabs/director/sw.cab#version=8,5,1,0"],["WindowsMedia","6bf52a52-394a-11d3-b153-00c04f79faa6,22d6f312-b0f6-11d0-94ab-0080c74c7e95,05589fa1-c356-11ce-bf01-00aa0055595a","application/x-mplayer2","http://activex.microsoft.com/activex/controls/mplayer/en/nsmp2inf.cab#Version=5,1,52,701"],["QuickTime","02bf25d5-8c17-4b23-bc80-d3488abddc6b","video/quicktime","http://www.apple.com/qtactivex/qtplugin.cab#version=6,0,2,0"],["RealMedia","cfcdaa03-8be4-11cf-b84b-0020afbbccfa","audio/x-pn-realaudio-plugin","http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0"],["Java","8ad9c840-044e-11d1-b3e9-00805f499d93","application/x-java-applet","http://java.sun.com/products/plugin/autodl/jinstall-1_5_0-windows-i586.cab#Version=1,5,0,0"],["Silverlight","dfeaf541-f3e1-4c24-acac-99c30715084a","application/x-silverlight-2"],["Iframe"],["Video"],["EmbeddedAudio"],["Audio"]];function c(k){var h,j;if(k&&!k.splice){h=[];for(j=0;true;j++){if(k[j]){h[j]=k[j]}else{break}}return h}return k}tinymce.create("tinymce.plugins.MediaPlugin",{init:function(m,h){var q=this,k={},l,o,p,j;function n(i){return i&&i.nodeName==="IMG"&&m.dom.hasClass(i,"mceItemMedia")}q.editor=m;q.url=h;a="";for(l=0;l<e.length;l++){j=e[l][0];p={name:j,clsids:tinymce.explode(e[l][1]||""),mimes:tinymce.explode(e[l][2]||""),codebase:e[l][3]};for(o=0;o<p.clsids.length;o++){k["clsid:"+p.clsids[o]]=p}for(o=0;o<p.mimes.length;o++){k[p.mimes[o]]=p}k["mceItem"+j]=p;k[j.toLowerCase()]=p;a+=(a?"|":"")+j}tinymce.each(m.getParam("media_types","video=mp4,m4v,ogv,webm;silverlight=xap;flash=swf,flv;shockwave=dcr;quicktime=mov,qt,mpg,mpeg;shockwave=dcr;windowsmedia=avi,wmv,wm,asf,asx,wmx,wvx;realmedia=rm,ra,ram;java=jar;audio=mp3,ogg").split(";"),function(v){var r,u,s;v=v.split(/=/);u=tinymce.explode(v[1].toLowerCase());for(r=0;r<u.length;r++){s=k[v[0].toLowerCase()];if(s){k[u[r]]=s}}});a=new RegExp("write("+a+")\\(([^)]+)\\)");q.lookup=k;m.onPreInit.add(function(){m.schema.addValidElements("object[id|style|width|height|classid|codebase|*],param[name|value],embed[id|style|width|height|type|src|*],video[*],audio[*],source[*]");m.parser.addNodeFilter("object,embed,video,audio,script,iframe",function(r){var s=r.length;while(s--){q.objectToImg(r[s])}});m.serializer.addNodeFilter("img",function(r,u,s){var v=r.length,w;while(v--){w=r[v];if((w.attr("class")||"").indexOf("mceItemMedia")!==-1){q.imgToObject(w,s)}}})});m.onInit.add(function(){if(m.theme&&m.theme.onResolveName){m.theme.onResolveName.add(function(i,r){if(r.name==="img"&&m.dom.hasClass(r.node,"mceItemMedia")){r.name="media"}})}if(m&&m.plugins.contextmenu){m.plugins.contextmenu.onContextMenu.add(function(r,s,i){if(i.nodeName==="IMG"&&i.className.indexOf("mceItemMedia")!==-1){s.add({title:"media.edit",icon:"media",cmd:"mceMedia"})}})}});m.addCommand("mceMedia",function(){var r,i;i=m.selection.getNode();if(n(i)){r=m.dom.getAttrib(i,"data-mce-json");if(r){r=f.parse(r);tinymce.each(d,function(s){var u=m.dom.getAttrib(i,s);if(u){r[s]=u}});r.type=q.getType(i.className).name.toLowerCase()}}if(!r){r={type:"iframe",video:{sources:[]},params:{}}}m.windowManager.open({file:h+"/media.htm",width:430+parseInt(m.getLang("media.delta_width",0)),height:500+parseInt(m.getLang("media.delta_height",0)),inline:1},{plugin_url:h,data:r})});m.addButton("media",{title:mediaTitle,cmd:"mceMedia"});m.onNodeChange.add(function(r,i,s){i.setActive("media",n(s))})},convertUrl:function(j,m){var i=this,l=i.editor,k=l.settings,n=k.url_converter,h=k.url_converter_scope||i;if(!j){return j}if(m){return l.documentBaseURI.toAbsolute(j)}return n.call(h,j,"src","object")},getInfo:function(){return{longname:"Media",author:"Moxiecode Systems AB",authorurl:"http://tinymce.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/media",version:tinymce.majorVersion+"."+tinymce.minorVersion}},dataToImg:function(l,j){var q=this,n=q.editor,o=n.documentBaseURI,h,p,m,k;l.params.src=q.convertUrl(l.params.src,j);p=l.video.attrs;if(p){p.src=q.convertUrl(p.src,j)}if(p){p.poster=q.convertUrl(p.poster,j)}h=c(l.video.sources);if(h){for(k=0;k<h.length;k++){h[k].src=q.convertUrl(h[k].src,j)}}m=q.editor.dom.create("img",{id:l.id,style:l.style,align:l.align,hspace:l.hspace,vspace:l.vspace,src:q.editor.theme.url+"/img/trans.gif","class":"mceItemMedia mceItem"+q.getType(l.type).name,"data-mce-json":f.serialize(l,"'")});m.width=l.width||(l.type=="audio"?"300":"378");m.height=l.height||(l.type=="audio"?"32":"310");return m},dataToHtml:function(h,i){return this.editor.serializer.serialize(this.dataToImg(h,i),{forced_root_block:"",force_absolute:i})},htmlToData:function(j){var i,h,k;k={type:"flash",video:{sources:[]},params:{}};i=this.editor.parser.parse(j);h=i.getAll("img")[0];if(h){k=f.parse(h.attr("data-mce-json"));k.type=this.getType(h.attr("class")).name.toLowerCase();tinymce.each(d,function(l){var m=h.attr(l);if(m){k[l]=m}})}return k},getType:function(l){var j,h,k;h=tinymce.explode(l," ");for(j=0;j<h.length;j++){k=this.lookup[h[j]];if(k){return k}}},imgToObject:function(z,m){var u=this,o=u.editor,C,G,h,s,H,y,F,w,j,r,p,A,D,l,x,k,B,E;function q(i,n){var L,K,M,J,I;I=o.getParam("flash_video_player_url",u.convertUrl(u.url+"/moxieplayer.swf"));if(I){L=o.documentBaseURI;F.params.src=I;if(o.getParam("flash_video_player_absvideourl",true)){i=L.toAbsolute(i||"",true);n=L.toAbsolute(n||"",true)}M="";K=o.getParam("flash_video_player_flashvars",{url:"$url",poster:"$poster"});tinymce.each(K,function(O,N){O=O.replace(/\$url/,i||"");O=O.replace(/\$poster/,n||"");if(O.length>0){M+=(M?"&":"")+N+"="+escape(O)}});if(M.length){F.params.flashvars=M}J=o.getParam("flash_video_player_params",{allowfullscreen:true,allowscriptaccess:true});tinymce.each(J,function(O,N){F.params[N]=""+O})}}F=z.attr("data-mce-json");if(!F){return}F=f.parse(F);p=this.getType(z.attr("class"));B=z.attr("data-mce-style");if(!B){B=z.attr("style");if(B){B=o.dom.serializeStyle(o.dom.parseStyle(B,"img"))}}if(p.name==="Iframe"){x=new b("iframe",1);tinymce.each(d,function(i){var n=z.attr(i);if(i=="class"&&n){n=n.replace(/mceItem.+ ?/g,"")}if(n&&n.length>0){x.attr(i,n)}});for(H in F.params){x.attr(H,F.params[H])}x.attr({style:B,"class":F["class"]});z.replace(x);return}if(this.editor.settings.media_use_script){x=new b("script",1).attr("type","text/javascript");y=new b("#text",3);y.value="write"+p.name+"("+f.serialize(tinymce.extend(F.params,{width:z.attr("width"),height:z.attr("height")}))+");";x.append(y);z.replace(x);return}if(p.name==="Video"&&F.video.sources[0]){C=new b("video",1).attr(tinymce.extend({id:z.attr("id"),width:z.attr("width"),height:z.attr("height"),style:B},F.video.attrs));if(F.video.attrs){k=F.video.attrs.poster}j=F.video.sources=c(F.video.sources);for(A=0;A<j.length;A++){if(/\.mp4$/.test(j[A].src)){l=j[A].src}}if(!j[0].type){C.attr("src",j[0].src);j.splice(0,1)}for(A=0;A<j.length;A++){w=new b("source",1).attr(j[A]);w.shortEnded=true;C.append(w)}if(l){q(l,k);p=u.getType("flash")}else{F.params.src=""}}if(p.name==="Audio"&&F.video.sources[0]){E=new b("audio",1).attr(tinymce.extend({id:z.attr("id"),width:z.attr("width"),height:z.attr("height"),style:B},F.video.attrs));if(F.video.attrs){k=F.video.attrs.poster}j=F.video.sources=c(F.video.sources);if(!j[0].type){E.attr("src",j[0].src);j.splice(0,1)}for(A=0;A<j.length;A++){w=new b("source",1).attr(j[A]);w.shortEnded=true;E.append(w)}F.params.src=""}if(p.name==="EmbeddedAudio"){h=new b("embed",1);h.shortEnded=true;h.attr({id:z.attr("id"),width:z.attr("width"),height:z.attr("height"),style:B,type:z.attr("type")});for(H in F.params){h.attr(H,F.params[H])}tinymce.each(d,function(i){if(F[i]&&i!="type"){h.attr(i,F[i])}});F.params.src=""}if(F.params.src){if(/\.flv$/i.test(F.params.src)){q(F.params.src,"")}if(m&&m.force_absolute){F.params.src=o.documentBaseURI.toAbsolute(F.params.src)}G=new b("object",1).attr({id:z.attr("id"),width:z.attr("width"),height:z.attr("height"),style:B});tinymce.each(d,function(i){var n=F[i];if(i=="class"&&n){n=n.replace(/mceItem.+ ?/g,"")}if(n&&i!="type"){G.attr(i,n)}});for(H in F.params){r=new b("param",1);r.shortEnded=true;y=F.params[H];if(H==="src"&&p.name==="WindowsMedia"){H="url"}r.attr({name:H,value:y});G.append(r)}if(this.editor.getParam("media_strict",true)){G.attr({data:F.params.src,type:p.mimes[0]})}else{G.attr({classid:"clsid:"+p.clsids[0],codebase:p.codebase});h=new b("embed",1);h.shortEnded=true;h.attr({id:z.attr("id"),width:z.attr("width"),height:z.attr("height"),style:B,type:p.mimes[0]});for(H in F.params){h.attr(H,F.params[H])}tinymce.each(d,function(i){if(F[i]&&i!="type"){h.attr(i,F[i])}});G.append(h)}if(F.object_html){y=new b("#text",3);y.raw=true;y.value=F.object_html;G.append(y)}if(C){C.append(G)}}if(C){if(F.video_html){y=new b("#text",3);y.raw=true;y.value=F.video_html;C.append(y)}}if(E){if(F.video_html){y=new b("#text",3);y.raw=true;y.value=F.video_html;E.append(y)}}var v=C||E||G||h;if(v){z.replace(v)}else{z.remove()}},objectToImg:function(C){var L,j,F,r,M,N,y,A,x,G,E,s,p,I,B,k,K,n,H=this.lookup,l,z,v=this.editor.settings.url_converter,m=this.editor.settings.url_converter_scope,w,q,D,h;function u(i){return new tinymce.html.Serializer({inner:true,validate:false}).serialize(i)}function J(O,i){return H[(O.attr(i)||"").toLowerCase()]}function o(O){var i=O.replace(/^.*\.([^.]+)$/,"$1");return H[i.toLowerCase()||""]}if(!C.parent){return}if(C.name==="script"){if(C.firstChild){l=a.exec(C.firstChild.value)}if(!l){return}n=l[1];K={video:{},params:f.parse(l[2])};A=K.params.width;x=K.params.height}K=K||{video:{},params:{}};M=new b("img",1);M.attr({src:this.editor.theme.url+"/img/trans.gif"});N=C.name;if(N==="video"||N=="audio"){F=C;L=C.getAll("object")[0];j=C.getAll("embed")[0];A=F.attr("width");x=F.attr("height");y=F.attr("id");K.video={attrs:{},sources:[]};z=K.video.attrs;for(N in F.attributes.map){z[N]=F.attributes.map[N]}B=C.attr("src");if(B){K.video.sources.push({src:v.call(m,B,"src",C.name)})}k=F.getAll("source");for(E=0;E<k.length;E++){B=k[E].remove();K.video.sources.push({src:v.call(m,B.attr("src"),"src","source"),type:B.attr("type"),media:B.attr("media")})}if(z.poster){z.poster=v.call(m,z.poster,"poster",C.name)}}if(C.name==="object"){L=C;j=C.getAll("embed")[0]}if(C.name==="embed"){j=C}if(C.name==="iframe"){r=C;n="Iframe"}if(L){A=A||L.attr("width");x=x||L.attr("height");G=G||L.attr("style");y=y||L.attr("id");w=w||L.attr("hspace");q=q||L.attr("vspace");D=D||L.attr("align");h=h||L.attr("bgcolor");K.name=L.attr("name");I=L.getAll("param");for(E=0;E<I.length;E++){p=I[E];N=p.remove().attr("name");if(!g[N]){K.params[N]=p.attr("value")}}K.params.src=K.params.src||L.attr("data")}if(j){A=A||j.attr("width");x=x||j.attr("height");G=G||j.attr("style");y=y||j.attr("id");w=w||j.attr("hspace");q=q||j.attr("vspace");D=D||j.attr("align");h=h||j.attr("bgcolor");for(N in j.attributes.map){if(!g[N]&&!K.params[N]){K.params[N]=j.attributes.map[N]}}}if(r){A=r.attr("width");x=r.attr("height");G=G||r.attr("style");y=r.attr("id");w=r.attr("hspace");q=r.attr("vspace");D=r.attr("align");h=r.attr("bgcolor");tinymce.each(d,function(i){M.attr(i,r.attr(i))});for(N in r.attributes.map){if(!g[N]&&!K.params[N]){K.params[N]=r.attributes.map[N]}}K["class"]=r.attr("class")}if(K.params.movie){K.params.src=K.params.src||K.params.movie;delete K.params.movie}if(K.params.src){K.params.src=v.call(m,K.params.src,"src","object")}if(F){if(C.name==="video"){n=H.video.name}else{if(C.name==="audio"){n=H.audio.name}}}if(L&&!n){n=(J(L,"clsid")||J(L,"classid")||J(L,"type")||{}).name}if(j&&!n){n=(J(j,"type")||o(K.params.src)||{}).name}if(j&&n=="EmbeddedAudio"){K.params.type=j.attr("type")}C.replace(M);if(j){j.remove()}if(L){s=u(L.remove());if(s){K.object_html=s}}if(F){s=u(F.remove());if(s){K.video_html=s}}K.hspace=w;K.vspace=q;K.align=D;K.bgcolor=h;M.attr({id:y,"class":"mceItemMedia mceItem"+(n||"Flash"),style:G,width:A||(C.name=="audio"?"300":"378"),height:x||(C.name=="audio"?"32":"310"),hspace:w,vspace:q,align:D,bgcolor:h,"data-mce-json":f.serialize(K,"'")})}});tinymce.PluginManager.add("media",tinymce.plugins.MediaPlugin)})();